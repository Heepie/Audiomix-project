{% extends 'base.html' %}

{% load static %}

{% block links %}
<link rel="stylesheet" href="{% static 'css/profile.css' %}">
{% endblock links %}

{% block scripts %}
<script src="{% static 'fontawesome/fontawesome-all.js' %}"></script>
{% endblock scripts %}

{% block content %}
<div class="profile-content container contents">
    <div class="profile-head" style="background-image: url({% static 'img/default-profile-cover.jpg' %})">
        <div class="user-info">
            {% if user.profile_img.name == '' %}
            <div class="profile-img img-circle" style="background-image: url('/static/img/default-profile.png')"></div>
            {% else %}
            <div class="profile-img img-circle" style="background-image: url('{{ user.profile_img.url }}')"></div>
            {% endif %}
            <div class="username-info">
                <h2 class="nickname">{{ user.nickname }}</h2>
                <span class="email">{{ user.email }}</span>
            </div>
            <div class="social-info">
                <div class="social-count" >
                    <p class="social-count-title">Total Likes</p>
                    <p class="social-count-num">{{ user.total_liked }}</p>
                </div>
                <div class="social-count" >
                    <p class="social-count-title">Following</p>
                    <p id="following-count" class="social-count-num">{{ user.following.count }}</p>
                </div>
                <div class="social-count" >
                    <p class="social-count-title">Followers</p>
                    <p id="follower-count" class="social-count-num">{{ user.followers.count }}</p>
                </div>
            </div>
        </div>
        {% if user == request.user or request.user.is_anonymous %}
        {% else %}
        {% csrf_token %}
        <button id="follow-btn" class="transition" data-follow-user="{% url 'views:user:follow' pk=user.pk %}">
            Follow
        </button>
        {% endif %}
    </div>
    <div class="profile-body">
        <div class="profile-body-wrapper">
            <div class="section section-left">
                <div class="menu-wrapper">
                    <button class="profile-body-menu transition"><span>All</span></button>
                    <button class="profile-body-menu transition"><span>Tracks</span></button>
                    <button class="profile-body-menu transition"><span>Comments</span></button>
                    <button class="profile-body-menu transition"><span>Playlist</span></button>
                </div>
                <div class="profile-body-content">
                    <div class="all-tracks tracklist">
                        {% for track in user_posts %}
                        <div class="track-obj">
                            {% if track.title %}

                            <!--post img-->
                            {% if track.post_img.name == '' %}
                            <div class="track-post-img" style="background-image: url({% static 'img/default-post-img.png' %}); background-size: unset; background-repeat: no-repeat;"></div>
                            {% else %}
                            <div class="track-post-img" style="background-image: url({{ track.post_img.url }});"></div>
                            {% endif %}
                            <!--post img-->
                            <div class="track-social-count">
                                <div class="item">
                                    <span id="like-btn-{{ track.pk }}" class="like-btn glyphicon glyphicon-heart-empty" data-post-pk="{{ track.pk }}" ></span>
                                    <span id="like-count-{{ track.pk }}" class="track-liked">{{ track.liked.count }}</span>
                                </div>
                                <div class="item">
                                    <span class="glyphicon glyphicon-music"></span>
                                    <span class="track-commented">{{ track.comment_tracks.count }}</span>
                                </div>

                            </div>
                            <div class="play-btn-wrapper">
                                <div id="play-btn-{{ forloop.counter }}" class="play-btn" onclick="playAudio({{ forloop.counter }});"><i class="fas fa-play-circle fa-3x"></i></div>
                            </div>

                            <div class="title-author-wrapper">
                                <p class="track-title">{{ track.title }}</p>
                                <a href="{% url 'views:user:user-detail' pk=track.author.pk %}"><p class="track-author">{{ track.author }}</p></a>
                            </div>

                            <div class="playtime">
                                <span id="playtime-current-{{ forloop.counter }}" class="track-duration-current">00:00</span> |
                                <span id="playtime-total-{{ forloop.counter }}" class="track-duration-total">00:00</span>
                            </div>

                            <!-- waveform -->
                            <audio id="track-audio-{{ forloop.counter }}" class="audio-track" data-src="{{ forloop.counter }}" data-isPlaying="false" onloadeddata="setTotalDuration({{ forloop.counter }})">
                                <source src="{{ track.author_track.url }}">
                            </audio>
                            <div id="waveform-wrapper-{{ forloop.counter }}" class="waveform-wrapper" >
                                <!--<div class="waveform-loader"></div>-->
                                    <img id="back-image-{{ forloop.counter }}" class="back-image" data-src="{{ forloop.counter }}" draggable="false" src="{{ track.author_track_waveform_base.url }}" alt="">
                                    <div id="image-cutter-{{ forloop.counter }}" class="cutter">
                                        <img class="cover-image" draggable="false" src="{{ track.author_track_waveform_cover.url }}" alt="">
                                    </div>
                            </div>
                            <!-- wavform end -->
                            <div class="track-genre">
                                {% for item in track.genre.all %}
                                <span class="track-genre-item">#{{ item }}</span>
                                {% endfor %}
                            </div>
                            {% else %}
                            <!--<p class="track-title">{{ track.post.title }}</p>-->
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="section section-right">
                <h1>section 2</h1>
            </div>
        </div>
    </div>
</div>

{% if request.user.is_anonymous %}

{% elif user == request.user %}
<script src="{% static 'js/profile/post-like.js' %}" ></script>
{% else %}
<script src="{% static 'js/profile/follow.js' %}"></script>
<script src="{% static 'js/profile/post-like.js' %}" ></script>
{% endif %}

<script src="{% static 'js/profile/waveform.js' %}"></script>

{% endblock content %}